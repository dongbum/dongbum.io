---
title: AWS Lightsail에서 PHP-FPM의 CPU 100% 폭주 현상
date: 2021-03-24 12:07:13
categories:
  - AWS
  - Lightsail
tags:
  - Amazon
  - AWS
  - Lightsail
  - 가상서버
  - 아마존
  - 클라우드
---

신경 쓰지 않고 내버려두었던 AWS Lightsail에 구축해놓은 홈페이지 서버가 갑자기 마비가 되어버렸다. 접속이 아예 안되는 것은 아닌데 무지무지하게 느려졌다. SSH로 접속해보니 CPU가 100%인 상황.

CPU를 모두 사용하고 있는건 php-fpm이었다. 그런데 이상한건 접속자가 없는 상황에서도 php-fpm이 계속 CPU 점유율 100%를 쓰고 있었고 nginx를 꺼버렸는데도 계속 100%였다.

뭔가 이상한 상황. 서버를 재부팅해도 해결되지 않았고 인스턴스 자체를 restart해도 해결되지 않았다.

구글에 검색하다보니 다음의 문서를 발견했다.

* <https://sarc.io/index.php/aws/1037-aws-lightsail-php-fpm-cpu>

**나와 동일한 케이스였는데 이 링크에서 설명한대로 Lightsail 콘솔에 들어가서 아예 stop하고 잠시 기다렸다가 start해주니 모든 것이 정상화되었다.**

이유도 알 수 없어서 조금 찝찝하지만 어쨌튼 완전히 종료하고 시작하는 것이 해결책이었다. 클라우드 환경에서는 이렇게 알 수 없는 문제들이 종종 생겨나고 단순히 인스턴스를 완전히 종료하고 재시작하는 것만으로 해결되는 경우가 종종 생겨나는 것 같다.

**2020년 4월 19일 추가**

위 재부팅만으로는 이 현상이 해결되지 않았다. 원인을 찾지 못한채 대략 일주일 정도의 시간이 흘렀고 어느날 갑자기 상태가 괜찮아졌다. AWS의 어떤 문제 때문에 생긴 일이었고 AWS에서 문제가 해결되었기 때문에 CPU 점유율이 정상적으로 돌아간 것으로 보여진다.
