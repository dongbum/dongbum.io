---
title: const shared_ptr reference
date: 2021-03-06 02:58:38
categories:
  - C/C++
tags:
  - C++
---

프로그램 코드를 작성하다보면 다음과 같은 코드가 나오게 되는데 두 코드는 사용방법이 같은 것 같으면서도 다른 점이 있다.

shared_ptr spUser

const shared_ptr& spUser

두 변수는 흔히 부르는 쉐어드포인터인데 코드 상에서는 같은듯 사용된다. 비주얼스튜디오 상에서도 두 변수는 아주 동일한 방법으로 사용되고 코드 힌트도 동일하게 나온다.

프로그램을 작성하며 이 두 변수가 그럼 완전히 동일한 것인가.. 생각을 하고 있던 중 이 두가지의 차이점을 찾아보게 되었다.

이 두가지의 차이점은 shared_ptr의 참조카운터가 증가하느냐 마느냐의 차이가 있다.

전자는 참조했으므로 참조카운터가 올라가지만, 후자는 레퍼런스를 사용했으므로 참조카운터가 올라가지 않는다. 그러므로 이 변수를 사용한 후, 이 변수를 람다 함수의 파라미터로 전달하거나 했을 때 유효하지 않을 수가 있다는 것이 문제다.

만약, 어떤 상태값을 체크하는 함수 등을 만들 때에는 후자를 쓰면 된다. 참조카운터를 올리는 것도 작지만 자원을 끌어다 쓰는 것이기 때문이다. 변수의 참조카운터 변화가 상관이 없는 부분에서는 후자를 쓰면 되고 람다함수의 파라미터로 넣는 등의 작업을 할 때는 전자를 쓰면 된다.

만약, 어떤 것을 써야할지 잘 모르겠다면 전자로 쓰는 것이 안전하긴 하다. 다만 후자로 써야할 곳에 전자로 쓴다면 자원을 아주 조금 낭비는 하겠지만 말이다.

이런 문제로 발생하는 버그는 눈으로 봐서는 쉽게 알아보기 힘든 버그이므로 작성시 주의해야한다.
